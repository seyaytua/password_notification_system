name: Build Windows Executable

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller
      
      - name: Build Windows executable
        run: |
          pyinstaller --onefile --windowed --name PasswordNotificationSystem --icon assets/icons/app_icon.ico main.py
      
      - name: Create ZIP archive
        run: |
          mkdir release
          move dist\PasswordNotificationSystem.exe release\
          echo "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŠçŸ¥ã‚‰ã›ã‚·ã‚¹ãƒ†ãƒ  v${{ github.ref_name }}" > release\README.txt
          echo "" >> release\README.txt
          echo "ä½¿ã„æ–¹:" >> release\README.txt
          echo "1. PasswordNotificationSystem.exe ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦èµ·å‹•" >> release\README.txt
          echo "2. å„Stepã‚’é †ç•ªã«å®Ÿè¡Œã—ã¦ãã ã•ã„" >> release\README.txt
          echo "3. CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã§ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã§ãã¾ã™" >> release\README.txt
          Compress-Archive -Path release\* -DestinationPath PasswordNotificationSystem-Windows-${{ github.ref_name }}.zip
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-Executable
          path: PasswordNotificationSystem-Windows-${{ github.ref_name }}.zip
      
      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: PasswordNotificationSystem-Windows-${{ github.ref_name }}.zip
          body: |
            ## ğŸ“¦ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŠçŸ¥ã‚‰ã›ã‚·ã‚¹ãƒ†ãƒ  ${{ github.ref_name }}
            
            ### â¬‡ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            **Windowsç‰ˆ**: `PasswordNotificationSystem-Windows-${{ github.ref_name }}.zip`
            
            ### ğŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
            1. ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            2. è§£å‡ã—ã¦ `PasswordNotificationSystem.exe` ã‚’å®Ÿè¡Œ
            3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒèµ·å‹•ã—ã¾ã™
            
            ### âœ¨ æ©Ÿèƒ½
            - **Step 1**: ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´
            - **Step 2**: ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
            - **Step 3**: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹PDFä½œæˆ
            - **Step 4**: ãƒ•ã‚¡ã‚¤ãƒ«æŒ¯ã‚Šåˆ†ã‘
            
            ### ğŸ’» å‹•ä½œç’°å¢ƒ
            - Windows 10/11 (64bit)
            - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
            - .NET Frameworkä¸è¦
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
